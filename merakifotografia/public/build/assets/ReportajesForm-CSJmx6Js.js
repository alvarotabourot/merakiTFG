import{T as L,y as R,r as B,f as b,o as n,c,b as o,a as r,t as f,u as a,d as x,k as h,z as y,v as I,F as v,g as w,w as N,h as P,m as k}from"./app-Ciu3P-SA.js";import{a as u,_ as m}from"./InputLabel-Boxk0wKV.js";import{_ as T}from"./TextInput-6cJox-sh.js";import{h as z}from"./heic2any-TgjPBaeP.js";const D={class:"text-2xl text-amethyst-6 font-mono font-bold text-center mb-4"},M={class:"text-center text-sm text-amethyst-6 mb-4"},O={class:"mt-3"},V={class:"flex flex-col items-center justify-center w-full relative"},A={for:"foto",class:"flex flex-col items-center justify-center w-full h-64 border-2 b border-dashed rounded-lg cursor-pointer bg-white"},G={class:"flex flex-col items-center justify-center pt-5 pb-6"},H={key:0,class:"absolute h-64 inset-0 flex items-center justify-center bg-black border-2 rounded-lg cursor-pointer"},q=["src"],J=o("p",{class:"mb-2 text-sm text-amethyst-7"},[o("span",{class:"font-semibold"},"Pincha para subir"),k(" o arrastra y suelta")],-1),K={class:"mt-4"},Q={class:"mt-4"},W={class:"mt-4"},X={class:"mt-4"},Y={class:"mt-4"},Z=o("option",{value:""},"Seleccione una categoria",-1),ee=["value"],te={key:0},oe={class:"mt-4"},se={key:0,class:"mt-1 block w-full"},ae=["src"],re=["onClick"],ie={key:1,class:"mt-4"},le=o("div",{class:"text-amethyst-8 flex items-center gap-4"}," Este reportaje no tiene fotos. ",-1),ne=[le],ce={class:"flex items-center justify-end mt-4"},he={__name:"ReportajesForm",props:{reportaje:Object,categorias:Array},emits:["formSubmitted","closeForm"],setup(g,{emit:j}){const _=g,C=j,e=L({id:null,foto:null,fotos:[],fotosExistentes:[],fotosParaEliminar:[],fecha:"",nombre:"",descripcion:"",categoria_id:null,currentImage:null});_.reportaje&&R(_.reportaje,t=>{t&&(e.id=t.id||null,e.currentImage=t.foto?`/imagenes/fotosReportajes/${t.foto}`:null,e.nombre=t.nombre||"",e.descripcion=t.descripcion||"",e.fecha=t.fecha||"",e.fotosExistentes=t.fotos||[],e.categoria_id=t.categoria_id||null)},{immediate:!0});const E=async t=>{const s=t.target.files[0];if(s)if(s.name.split(".").pop().toLowerCase()==="heic"||s.name.split(".").pop().toLowerCase()==="hevc")try{const l=await z({blob:s,toType:"image/png"}),d=new File([l],s.name.split(".")[0]+".png",{type:"image/png"});e.foto=d,e.currentImage=URL.createObjectURL(d)}catch(l){console.error("Error converting HEIC to PNG: ",l)}else e.foto=s,e.currentImage=URL.createObjectURL(s)},F=t=>{e.fotos=[...t.target.files]},$=()=>{const t=new FormData;t.append("_method",e.id?"put":"post"),e.foto&&t.append("foto",e.foto),e.fotos.forEach((l,d)=>{t.append(`fotos[${d}]`,l)}),e.fotosParaEliminar.forEach(l=>{t.append("fotos_para_eliminar[]",l)}),t.append("nombre",e.nombre),t.append("descripcion",e.descripcion),t.append("fecha",e.fecha),t.append("categoria_id",e.categoria_id);const s=e.id?"reportaje.update":"reportaje.create";e.post(route(s,e.id||""),{data:t,onSuccess:()=>{e.reset(),C("formSubmitted")},onError:()=>{}})},S=t=>{e.fotosParaEliminar.push(t),e.fotosExistentes=e.fotosExistentes.filter(s=>s.id!==t)},p=B(!1),U=()=>{p.value=!p.value};return(t,s)=>{const l=b("font-awesome-icon"),d=b("Button");return n(),c("form",{onSubmit:P($,["prevent"]),enctype:"multipart/form-data",class:"w-70 p-4 h-[30rem] overflow-auto bg-amethyst-2 text-white relative rounded-lg"},[o("button",{onClick:s[0]||(s[0]=i=>t.$emit("closeForm")),class:"text-gray-400 div absolute right-2 top-2 text-xl font-bold focus:outline-none"},[r(l,{icon:["fas","xmark"]})]),o("h2",D,f(a(e).id?"Editar":"Crear")+" reportaje",1),o("p",M,"Completa los detalles a continuación para "+f(a(e).id?"actualizar":"crear")+" el reportaje.",1),o("div",O,[r(m,{for:"foto",value:"Portada",class:"text-amethyst-6"}),o("div",V,[o("input",{type:"file",id:"foto",name:"foto",class:"mt-1 hidden w-full z-10 opacity-0 cursor-pointer",onChange:E},null,32),o("label",A,[o("div",G,[a(e).currentImage?(n(),c("div",H,[o("img",{class:"w-full h-full object-contain",src:a(e).currentImage,alt:"Vista previa de la imagen"},null,8,q)])):x("",!0),r(l,{icon:["fas","camera"],class:"text-amethyst-8 text-8xl"}),J])])]),r(u,{message:a(e).errors.foto,class:"mt-2 text-red-500"},null,8,["message"])]),o("div",K,[r(m,{for:"fotos",value:"Subir fotos al reportaje",class:"text-amethyst-6"}),o("input",{type:"file",id:"fotos",name:"fotos",class:"mt-1 block w-full text-amethyst-8 bg-white border-green-500",multiple:"",onChange:F},null,32),r(u,{message:a(e).errors.fotos,class:"mt-2 text-red-500"},null,8,["message"])]),o("div",Q,[r(m,{for:"nombre",value:"Título",class:"text-amethyst-6"}),r(T,{id:"nombre",modelValue:a(e).nombre,"onUpdate:modelValue":s[1]||(s[1]=i=>a(e).nombre=i),class:"mt-1 block w-full bg-white text-amethyst-8 border-green-500 p-1"},null,8,["modelValue"]),r(u,{message:a(e).errors.nombre,class:"mt-2 text-red-500"},null,8,["message"])]),o("div",W,[r(m,{for:"descripcion",value:"Descripción",class:"text-amethyst-6"}),h(o("textarea",{id:"descripcion","onUpdate:modelValue":s[2]||(s[2]=i=>a(e).descripcion=i),class:"mt-1 block w-full bg-wite text-amethyst-8 border-green-500 p-1"},null,512),[[y,a(e).descripcion]]),r(u,{message:a(e).errors.descripcion,class:"mt-2 text-red-500"},null,8,["message"])]),o("div",X,[r(m,{for:"fecha",value:"Fecha",class:"text-amethyst-6"}),h(o("input",{type:"date",id:"fecha","onUpdate:modelValue":s[3]||(s[3]=i=>a(e).fecha=i),class:"mt-1 block w-full bg-white text-amethyst-8 border-green-500 p-1"},null,512),[[y,a(e).fecha]]),r(u,{message:a(e).errors.fecha,class:"mt-2 text-red-500"},null,8,["message"])]),o("div",Y,[r(m,{for:"categoria_id",value:"Categoria",class:"text-amethyst-6"}),h(o("select",{id:"categoria_id","onUpdate:modelValue":s[4]||(s[4]=i=>a(e).categoria_id=i),class:"mt-1 block w-full bg-white text-amethyst-8 border-green-500 p-1"},[Z,(n(!0),c(v,null,w(g.categorias,i=>(n(),c("option",{value:i.id},f(i.nombre),9,ee))),256))],512),[[I,a(e).categoria_id]]),r(u,{message:a(e).errors.categoria_id,class:"mt-2 text-red-500"},null,8,["message"])]),a(e).fotosExistentes.length>0?(n(),c("div",te,[o("div",oe,[r(m,{value:"Fotos existentes",class:"text-amethyst-6"}),o("button",{type:"button",onClick:U,class:"bg-amethyst-6 text-white px-3 py-1 rounded-full"},f(p.value?"Ocultar":"Mostrar")+" Fotos ",1),p.value?(n(),c("div",se,[(n(!0),c(v,null,w(a(e).fotosExistentes,i=>(n(),c("div",{key:i.id,class:"text-green-500 flex items-center gap-4"},[o("img",{src:`/imagenes/fotosReportajes/${i.url}`,target:"_blank",class:"inline-block w-50 overflow-hidden mt-2"},null,8,ae),o("button",{type:"button",onClick:me=>S(i.id),class:"bg-red-500 text-white px-2 py-1 rounded-full"}," Eliminar ",8,re)]))),128))])):x("",!0)])])):(n(),c("div",ie,ne)),o("div",ce,[r(d,{class:"bg-amethyst-6 hover:bg-amethyst-8 text-white ml-4 pl-2 pr-2 rounded-full"},{default:N(()=>[k(f(a(e).id?"Actualizar":"Crear"),1)]),_:1})])],32)}}};export{he as default};
